From b05d31dd286a5872503facacf87b53460a72aae6 Mon Sep 17 00:00:00 2001
From: "Reynaldo H. Verdejo Pinochet" <reynaldo@collabora.com>
Date: Thu, 30 May 2013 17:27:46 -0400
Subject: [PATCH] client: Adding some debug messages on Android

---
 configure.ac            |   17 +++++++++++++++++
 libgssdp/Makefile.am    |    4 ++++
 libgssdp/gssdp-client.c |   10 ++++++++++
 3 files changed, 31 insertions(+)

diff --git a/configure.ac b/configure.ac
index 3019c0a..0ca1cb3 100644
--- a/configure.ac
+++ b/configure.ac
@@ -15,6 +15,9 @@ AM_MAINTAINER_MODE([enable])
 
 AM_SILENT_RULES([yes])
 
+AC_CANONICAL_HOST
+AC_CANONICAL_TARGET
+
 AC_SEARCH_LIBS([strerror],[cposix])
 AC_PROG_CC
 AC_HEADER_STDC
@@ -102,6 +105,20 @@ esac
 AC_MSG_RESULT([$os_win32])
 AM_CONDITIONAL(OS_WIN32, [test $os_win32 = yes])
 
+dnl Check for Android
+AC_MSG_CHECKING([for Android as target OS])
+target_android=no
+case "$target_os" in
+    linux-android*)
+        target_android=yes
+        ;;
+    *)
+        target_android=no
+        ;;
+esac
+AC_MSG_RESULT([$target_android])
+AM_CONDITIONAL(TARGET_ANDROID, [test $target_android = yes])
+
 GTK_DOC_CHECK([1.0])
 
 AC_CONFIG_FILES([
diff --git a/libgssdp/Makefile.am b/libgssdp/Makefile.am
index f8d4dc2..c250f64 100644
--- a/libgssdp/Makefile.am
+++ b/libgssdp/Makefile.am
@@ -56,6 +56,10 @@ libgssdp_1_0_la_LIBADD += -lws2_32 -liphlpapi
 libgssdp_1_0_la_LDFLAGS += -no-undefined
 endif
 
+if TARGET_ANDROID
+libgssdp_1_0_la_LIBADD += -llog
+endif
+
 EXTRA_DIST = gssdp-marshal.list
 
 CLEANFILES = $(BUILT_SOURCES)
diff --git a/libgssdp/gssdp-client.c b/libgssdp/gssdp-client.c
index f91cadf..d81796d 100644
--- a/libgssdp/gssdp-client.c
+++ b/libgssdp/gssdp-client.c
@@ -76,6 +76,10 @@ typedef unsigned long in_addr_t;
 #define INET6_ADDRSTRLEN 46
 #endif
 
+#ifdef __BIONIC__
+#include <android/log.h>
+#endif
+
 /* Size of the buffer used for reading from the socket */
 #define BUF_SIZE 65536
 
@@ -1258,6 +1262,8 @@ get_host_ip (GSSDPNetworkDevice *device)
                 goto fail;
 
         if (device->iface_name != NULL) {
+                __android_log_write(ANDROID_LOG_DEBUG, "gssdp",
+                        "Got an interface name");
                 /* We have an actual interface request */
                 iface = calloc (1, sizeof (struct ifreq));
                 strncpy (iface->ifr_name, device->iface_name, IFNAMSIZ);
@@ -1279,6 +1285,8 @@ get_host_ip (GSSDPNetworkDevice *device)
 
         }
 
+        __android_log_write(ANDROID_LOG_DEBUG, "gssdp",
+                "Got no interface name. Selecting our own");
         /* No interface name was passed on as query. Need
          * to figure out address of the first active/configured
          * device and pass that over
@@ -1311,6 +1319,8 @@ get_host_ip (GSSDPNetworkDevice *device)
 
         } while (!got_all);
 
+        __android_log_write(ANDROID_LOG_DEBUG, "gssdp",
+                "List of interfaces ready. Now finding first configured one");
         /* Got the list. Find and set (on *device)
          * data for the first configured device and
          * return */
-- 
1.7.10.4

